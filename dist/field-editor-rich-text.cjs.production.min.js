"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),n=e(t),r=e(require("prop-types")),i=require("slate-react"),o=require("slate"),s=e(require("lodash/noop")),a=e(require("lodash/debounce")),c=require("immutable"),l=e(require("fast-deep-equal")),u=require("@contentful/rich-text-types"),d=require("@contentful/contentful-slatejs-adapter"),p=require("@contentful/field-editor-reference"),f=e(require("lodash/fromPairs")),h=e(require("@productboard/slate-edit-list")),m=require("@contentful/forma-36-react-components"),y=e(require("is-hotkey")),E=require("emotion"),g=e(require("@contentful/forma-36-tokens")),v=e(require("lodash/camelCase")),b=e(require("lodash/flow")),S=e(require("lodash/find")),T=e(require("lodash/get")),C=require("detect-browser"),k=require("@contentful/field-editor-shared"),A=e(require("@wikifactory/slate-trailing-block")),I=require("@contentful/rich-text-plain-text-renderer"),L=e(require("slate-html-serializer")),x=e(require("slate-plain-serializer")),D=e(require("react-dom")),N=e(require("lodash/throttle")),R=e(require("lodash/flatten")),w=e(require("classnames")),B=e(require("lodash/uniqBy"));function P(e,t,n,r,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function O(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function s(e){P(o,r,i,s,a,"next",e)}function a(e){P(o,r,i,s,a,"throw",e)}s(void 0)}))}}function K(){return(K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function _(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function M(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||(i[n]=e[n]);return i}function H(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function q(e,t){return t||(t=e.slice(0)),e.raw=t,e}var j,U,F,Y=function(e){var t=K({types:[u.BLOCKS.OL_LIST,u.BLOCKS.UL_LIST],typeItem:u.BLOCKS.LIST_ITEM,typeDefault:u.BLOCKS.PARAGRAPH},e);return h(t)},G=function(e){return f(e.map((function(e){return[e,{isVoid:!0}]})))},z=Y(),W={document:{nodes:[{types:u.TOP_LEVEL_BLOCKS}]},blocks:K((j={},j[u.BLOCKS.PARAGRAPH]={nodes:[{types:Object.values(u.INLINES)},{objects:["text","inline"]}]},j[u.BLOCKS.HEADING_1]={nodes:[{types:Object.values(u.INLINES)},{objects:["text","inline"]}]},j[u.BLOCKS.HEADING_2]={nodes:[{types:Object.values(u.INLINES)},{objects:["text","inline"]}]},j[u.BLOCKS.HEADING_3]={nodes:[{types:Object.values(u.INLINES)},{objects:["text","inline"]}]},j[u.BLOCKS.HEADING_4]={nodes:[{types:Object.values(u.INLINES)},{objects:["text","inline"]}]},j[u.BLOCKS.HEADING_5]={nodes:[{types:Object.values(u.INLINES)},{objects:["text","inline"]}]},j[u.BLOCKS.HEADING_6]={nodes:[{types:Object.values(u.INLINES)},{objects:["text","inline"]}]},j),G(u.VOID_BLOCKS),z.schema.blocks,(U={},U[u.BLOCKS.QUOTE]={nodes:[{match:[u.CONTAINERS[u.BLOCKS.QUOTE].map((function(e){return{type:e}}))],min:1}],normalize:function(e,t){if("child_type_invalid"===t.code)return e.unwrapBlockByKey(t.node.key,u.BLOCKS.QUOTE)}},U)),inlines:(F={},F[u.INLINES.HYPERLINK]={nodes:[{objects:["text"]}]},F[u.INLINES.ENTRY_HYPERLINK]={nodes:[{objects:["text"]}]},F[u.INLINES.ASSET_HYPERLINK]={nodes:[{objects:["text"]}]},F[u.INLINES.EMBEDDED_ENTRY]={isVoid:!0},F)},V=function(e,t){return function(n,r){e(n,K({origin:t},r))}},Q=function(e){var t=e.onAction;return{sdk:e.sdk,logViewportAction:V(t,"viewport-interaction"),logShortcutAction:V(t,"shortcut"),logToolbarAction:V(t,"toolbar-icon"),logCommandPaletteAction:V(t,"command-palette")}},X=K({},{richTextAPI:r.shape({sdk:r.object.isRequired,logViewportAction:r.func.isRequired,logShortcutAction:r.func.isRequired,logToolbarAction:r.func.isRequired})},{editor:r.object.isRequired,onToggle:r.func.isRequired,disabled:r.bool.isRequired,isButton:r.bool,canAutoFocus:r.bool}),J=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).handleClick=function(e){e.preventDefault(),t.props.onToggle(e)},t}return _(t,e),t.prototype.render=function(){var e=this.props,t=e.title;return n.createElement(m.EditorToolbarButton,{icon:e.icon,tooltip:t,label:t,isActive:e.isActive,disabled:e.disabled,"data-test-id":"toolbar-toggle-"+e.type,onClick:this.handleClick})},t}(t.Component);J.propTypes={isActive:r.bool.isRequired,disabled:r.bool.isRequired,onToggle:r.func.isRequired,icon:r.string.isRequired,title:r.string.isRequired,type:r.string};var $={attributes:r.object.isRequired,children:r.node.isRequired,mark:r.string.isRequired},Z={attributes:r.object.isRequired,children:r.node.isRequired,node:r.shape({type:r.string.isRequired}).isRequired},ee=function(e,t){return e.value.activeMarks.some((function(e){return e.type===t}))},te=function(e,t){return e.value.blocks.some((function(e){return e.type===t}))},ne=function(e,t){return e.value.inlines.some((function(e){return e.type===t}))},re=function(e){var t=e.value;if(t.blocks.size>0)return t.blocks.some((function(e){return e.text}))},ie={bold:E.css({color:"inherit",fontWeight:g.fontWeightDemiBold}),italic:E.css({fontStyle:"italic",lineHeight:1}),code:E.css({fontFamily:g.fontStackMonospace,fontSize:".9em"})};function oe(e){var t=e.type,r=e.tagName,i=e.hotkey,o=e.richTextAPI;return{renderMark:function(e,i,o){return e.mark.type===t?function(e,t){void 0===t&&(t={});var r=function(r){var i=r.children;return n.createElement(e,K({},t,r.attributes),i)};return r.displayName=e+"-mark",r.propTypes=$,r}(r,{className:ie[t]})(e):o()},onKeyDown:function(e,n,r){if(!y(i,e))return r();n.toggleMark(t);var s=ee(n,t)?"mark":"unmark";o.logShortcutAction(s,{markType:t})}}}var se=function(e,t){return function(n){n.preventDefault();var r=e.props,i=r.editor;if(!i.value.selection.isFocused){if(!r.canAutoFocus)return;i.focus()}return t(n)}},ae=function(e){var n=e.type,r=e.title,i=e.icon;return function(e){var o,s;return s=o=function(o){function s(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=o.call.apply(o,[this].concat(r))||this).handleToggle=se(H(e),(function(){var t=e.props,r=t.editor,i=t.richTextAPI.logToolbarAction;(0,t.onToggle)(r.toggleMark(n)),i(ee(r,n)?"mark":"unmark",{markType:n})})),e}return _(s,o),s.prototype.render=function(){var o=this.props,s=o.disabled;return t.createElement(e,{type:n,icon:i,title:r,onToggle:this.handleToggle,isActive:ee(o.editor,n),disabled:s})},s}(t.Component),o.propTypes=X,s}},ce=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t.prototype.render=function(){return n.createElement(J,this.props)},t}(t.Component),le=ae({type:u.MARKS.BOLD,title:"Bold",icon:"FormatBold"})(ce),ue=function(e){return oe({type:u.MARKS.ITALIC,tagName:"em",hotkey:["mod+i"],richTextAPI:e.richTextAPI})},de=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t.prototype.render=function(){return n.createElement(J,this.props)},t}(t.Component),pe=ae({type:u.MARKS.ITALIC,title:"Italic",icon:"FormatItalic"})(de),fe=function(e){return oe({type:u.MARKS.UNDERLINE,tagName:"u",hotkey:["mod+u"],richTextAPI:e.richTextAPI})},he=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t.prototype.render=function(){return n.createElement(J,this.props)},t}(t.Component),me=ae({type:u.MARKS.UNDERLINE,title:"Underline",icon:"FormatUnderlined"})(he),ye=function(e){return oe({type:u.MARKS.CODE,tagName:"code",hotkey:["mod+/"],richTextAPI:e.richTextAPI})},Ee=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t.prototype.render=function(){return n.createElement(J,this.props)},t}(t.Component),ge=ae({type:u.MARKS.CODE,title:"Code",icon:"Code"})(Ee),ve=function(e,t){var n=te(e,t);return e.setBlocks(n?u.BLOCKS.PARAGRAPH:t),!n},be=function(e,t){return te(e,t)},Se=function(e){var n=e.type,r=e.title,i=e.icon,o=e.applyChange,s=void 0===o?ve:o,a=e.isActive,c=void 0===a?be:a;return function(e){var o,a;return a=o=function(o){function a(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=o.call.apply(o,[this].concat(r))||this).handleToggle=se(H(e),(function(){var t=e.props,r=t.editor,i=t.onToggle,o=t.richTextAPI.logToolbarAction,a=s(r,n);i(r),o(a?"insert":"remove",{nodeType:n})})),e}return _(a,o),a.prototype.render=function(){var o=this.props,s=o.disabled,a=o.richTextAPI;return t.createElement(e,{type:n,icon:i,title:r,onToggle:this.handleToggle,isActive:c(o.editor,n),disabled:s,richTextAPI:a})},a}(t.Component),o.propTypes=X,a}},Te=function(e){var t=function(e){var t=e.value.selection;if(!t.start.key)return null;var n=e.value.document.getClosestBlock(t.start.key);return e.value.document.getParent(n.key)}(e);return!!t&&t.type===u.BLOCKS.QUOTE},Ce=function(e){var t=Te(e);return t?e.unwrapBlock(u.BLOCKS.QUOTE):e.setBlocks(u.BLOCKS.PARAGRAPH).wrapBlock(u.BLOCKS.QUOTE),!t},ke={fontWeight:g.fontWeightMedium,lineHeight:"1.3",margin:"0 0 "+g.spacingS},Ae={paragraph:E.css({lineHeight:g.lineHeightDefault,marginBottom:"1.5em"}),bold:E.css({color:"inherit",fontWeight:g.fontWeightDemiBold}),blockquote:E.css({margin:"0 0 1.3125rem",borderLeft:"6px solid "+g.colorElementLight,paddingLeft:"0.875rem",fontStyle:"normal","& a":{color:"inherit"}}),code:E.css({background:g.colorElementLight,padding:"0px",color:g.colorTextMid,borderRadius:"2px"}),textLink:E.css({fontSize:"inherit"}),orderedList:E.css({margin:"0 0 1.25rem 1.25rem",listStyleType:"decimal",'[data-test-id="ordered-list"]':{listStyleType:"upper-alpha",'[data-test-id="ordered-list"]':{listStyleType:"lower-roman",'[data-test-id="ordered-list"]':{listStyleType:"lower-alpha"}}},'[data-test-id="paragraph"]':{margin:0,lineHeight:g.lineHeightDefault}}),unorderedList:E.css({margin:"0 0 1.25rem 1.25rem",listStyleType:"disc",'[data-test-id="unordered-list"]':{listStyleType:"circle",'[data-test-id="unordered-list"]':{listStyleType:"square"}},'[data-test-id="paragraph"]':{margin:0,lineHeight:g.lineHeightDefault}}),listItem:E.css({listStyle:"inherit",margin:0,'[data-test-id="ordered-list"], [data-test-id="unordered-list"]':{margin:"0 0 0 "+g.spacingL}}),heading1:E.css(K({},ke,{fontSize:"1.875rem"})),heading2:E.css(K({},ke,{fontSize:"1.5625rem"})),heading3:E.css(K({},ke,{fontSize:"1.375rem"})),heading4:E.css(K({},ke,{fontSize:"1.25rem"})),heading5:E.css(K({},ke,{fontSize:"1.125rem"})),heading6:E.css(K({},ke,{fontSize:"1rem"}))};function Ie(e,n){void 0===n&&(n={});var r=function(r){var i=r.attributes,o=r.children,s=r.node;return t.createElement(e,K({className:Ae[v(s.type)],"data-test-id":s.type},n,i),o)};return r.displayName=e+"-node",r.propTypes=Z,r}var Le,xe=function(e,t,n){return function(t){var r=t.type,i=void 0===r?e:r,o=t.richTextAPI.logShortcutAction;return{renderNode:function(e,t,n){return e.node.type===i?Ie("blockquote")(e):n()},onKeyDown:function(e,t,r){if(y(n,e)){var s=Ce(t);o(s?"insert":"remove",{nodeType:i})}else{if(!y("Backspace",e)||!Te(t)||re(t))return r();t.unwrapBlock(u.BLOCKS.QUOTE).delete()}}}}}(u.BLOCKS.QUOTE,0,["mod+shift+1"]),De=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t.prototype.render=function(){return n.createElement(J,this.props)},t}(t.Component),Ne=Se({type:u.BLOCKS.QUOTE,title:"Blockquote",icon:"Quote",applyChange:Ce,isActive:Te})(De),Re=(function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function a(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(e){a=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=Object.create((t&&t.prototype instanceof d?t:d).prototype),o=new C(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=b(s,n);if(a){if(a===u)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=l(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,o),i}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function d(){}function p(){}function f(){}var h={};h[i]=function(){return this};var m=Object.getPrototypeOf,y=m&&m(m(k([])));y&&y!==t&&n.call(y,i)&&(h=y);var E=f.prototype=d.prototype=Object.create(h);function g(e){["next","throw","return"].forEach((function(t){a(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){var r;this._invoke=function(i,o){function s(){return new t((function(r,s){!function r(i,o,s,a){var c=l(e[i],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,s,a)}),(function(e){r("throw",e,s,a)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,a)}))}a(c.arg)}(i,o,r,s)}))}return r=r?r.then(s,s):s()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function k(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}return p.prototype=E.constructor=f,f.constructor=p,p.displayName=a(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,a(e,s,"GeneratorFunction")),e.prototype=Object.create(E),e},e.awrap=function(e){return{__await:e}},g(v.prototype),v.prototype[o]=function(){return this},e.AsyncIterator=v,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var s=new v(c(t,n,r,i),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},g(E),a(E,s,"Generator"),E[i]=function(){return this},E.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=k,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var a=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:k(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}(Le={exports:{}}),Le.exports);function we(e){var n=p.useEntities(),r=n.loadEntry,i=n.entries;t.useEffect((function(){r(e.entryId)}),[e.entryId]);var o=i[e.entryId];if(t.useEffect((function(){o&&e.onEntityFetchComplete&&e.onEntityFetchComplete()}),[o]),"failed"===o)return t.createElement(p.MissingEntityCard,{entityType:"Entry",isDisabled:e.isDisabled,onRemove:e.onRemove});if(void 0===o)return t.createElement(m.EntryCard,{size:"default",loading:!0});var s=e.sdk.space.getCachedContentTypes().find((function(e){return e.sys.id===o.sys.contentType.sys.id}));return t.createElement(p.WrappedEntryCard,{getAsset:e.sdk.space.getAsset,getEntityScheduledActions:e.sdk.space.getEntityScheduledActions,entryUrl:e.getEntryUrl&&e.getEntryUrl(o.sys.id),size:"default",isSelected:e.isSelected,isDisabled:e.isDisabled,localeCode:e.locale,defaultLocaleCode:e.sdk.locales.default,contentType:s,entry:o,onEdit:e.onEdit,onRemove:e.onRemove,isClickable:!1})}function Be(e){var n=p.useEntities(),r=n.loadAsset,i=n.assets;t.useEffect((function(){r(e.assetId)}),[e.assetId]);var o=i[e.assetId];return t.useEffect((function(){o&&e.onEntityFetchComplete&&e.onEntityFetchComplete()}),[o]),"failed"===o?t.createElement(p.MissingEntityCard,{entityType:"Asset",isDisabled:e.isDisabled,onRemove:e.onRemove}):void 0===o?t.createElement(m.AssetCard,{size:"default",isLoading:!0,title:"",src:"",href:""}):t.createElement(p.WrappedAssetCard,{getAsset:e.sdk.space.getAsset,getEntityScheduledActions:e.sdk.space.getEntityScheduledActions,getAssetUrl:e.getAssetUrl,size:"default",isSelected:e.isSelected,isDisabled:e.isDisabled,localeCode:e.locale,defaultLocaleCode:e.sdk.locales.default,asset:o,onEdit:e.onEdit,onRemove:e.onRemove,isClickable:!1})}function Pe(e){var t=e.sys;return{sys:{id:t.id,type:"Link",linkType:t.type}}}we.propTypes={sdk:r.object.isRequired,entryId:r.string.isRequired,locale:r.string.isRequired,isDisabled:r.bool.isRequired,isSelected:r.bool.isRequired,onRemove:r.func,onEdit:r.func,getEntryUrl:r.func,onEntityFetchComplete:r.func},Be.propTypes={sdk:r.object.isRequired,locale:r.string.isRequired,assetId:r.string.isRequired,isDisabled:r.bool.isRequired,isSelected:r.bool.isRequired,onRemove:r.func,onEdit:r.func,getAssetUrl:r.func,onEntityFetchComplete:r.func};var Oe=function(e){function t(t){var n,r;(r=e.call(this,t)||this).handleSubmit=function(e){e.preventDefault(),r.props.onClose(r.getValue())},r.selectEntry=O(Re.mark((function e(){var t,n,i;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(t=r.props.entitySelectorConfigs.Entry).locale,i=t.contentTypes,e.next=3,r.props.sdk.dialogs.selectSingleEntry({locale:n,contentTypes:i});case 3:r.setTargetEntity("Entry",e.sent);case 5:case"end":return e.stop()}}),e)}))),r.selectAsset=O(Re.mark((function e(){var t;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.props.entitySelectorConfigs.Asset.locale,e.next=3,r.props.sdk.dialogs.selectSingleAsset({locale:t});case 3:r.setTargetEntity("Asset",e.sent);case 5:case"end":return e.stop()}}),e)})));var i=t.value,o=i.text,s=i.type,a=i.uri,c=i.target,l=Boolean(c),u=((n={}).Entry=null,n.Asset=null,n),d=s;return l?u[d=c.sys.linkType]=c:d=t.allowedHyperlinkTypes.includes("uri")?"uri":t.allowedHyperlinkTypes[0],r.state={text:o,uri:a,entityLinks:u,type:d},r}_(t,e);var r=t.prototype;return r.setTargetEntity=function(e,t){this.setState((function(n){var r;return{entityLinks:K({},n.entityLinks,(r={},r[e]=t?Pe(t):void 0,r))}}))},r.getValue=function(){var e=this.state,t=e.text,n=e.type,r=e.uri,i={type:n};return t&&(i.text=t),"uri"===n?i.uri=r:i.target=this.state.entityLinks[n],i},r.isLinkComplete=function(){var e=this.getValue();return!(!this.props.hideText&&!e.text)&&("uri"===e.type&&e.uri||e.target)},r.render=function(){var e=this,t=this.props.labels;return n.createElement(p.EntityProvider,{sdk:this.props.sdk},n.createElement(n.Fragment,null,n.createElement(m.Modal.Content,null,this.renderFields()),n.createElement(m.Modal.Controls,null,n.createElement(m.Button,{type:"submit",buttonType:"positive",onClick:this.handleSubmit,disabled:!this.isLinkComplete(),testId:"confirm-cta"},t.confirm),n.createElement(m.Button,{type:"button",onClick:function(){return e.props.onClose(null)},buttonType:"muted",testId:"cancel-cta"},"Cancel"))))},r.renderFields=function(){var e=this,t=this.props,r=t.hideText,i=t.allowedHyperlinkTypes,o=t.entitySelectorConfigs,s=this.state,a=s.uri,c=s.text,l=s.type,u="uri"===l&&(r||!!c);return n.createElement(m.Form,null,r?null:n.createElement(m.TextField,{required:!0,labelText:"Link text",value:c||"",onChange:function(t){return e.setState({text:t.target.value})},id:"link-text",name:"link-text",textInputProps:{testId:"link-text-input",autoFocus:!u}}),function(e){return void 0===e&&(e={}),!!e.Entry||!!e.Asset}(o)&&n.createElement(m.SelectField,{labelText:"Link type",value:l,onChange:function(t){return e.setState({type:t.target.value})},name:"link-type",id:"link-type",selectProps:{testId:"link-type-select"}},i.includes("uri")||"uri"===l?n.createElement(m.Option,{value:"uri"},"URL"):null,i.includes("Entry")||"Entry"===l?n.createElement(m.Option,{value:"Entry"},"Entry"):null,i.includes("Asset")||"Asset"===l?n.createElement(m.Option,{value:"Asset"},"Asset"):null),"uri"===l?n.createElement(m.TextField,{required:!0,labelText:"Link target",value:a||"",textInputProps:{placeholder:"https://",testId:"link-uri-input",autoFocus:u},helpText:"A protocol may be required, e.g. https://",onChange:function(t){return e.setState({uri:t.target.value})},id:"link-uri",name:"link-uri"}):this.renderEntityField())},r.renderEntityField=function(){var e=this,t=this.state,r=t.type,i=t.entityLinks[r],o=!i;return n.createElement("div",null,n.createElement(m.FormLabel,{required:!0,htmlFor:""},"Link target"),!o&&n.createElement(m.TextLink,{className:E.css({marginLeft:g.spacingS}),onClick:function(){return e.setTargetEntity(r,null)}},"Remove selection"),i&&n.createElement("div",null,"Entry"===r&&n.createElement(we,{sdk:this.props.sdk,locale:this.props.entitySelectorConfigs.Entry.locale,entryId:i.sys.id,isDisabled:!0,isSelected:!1}),"Asset"==r&&n.createElement(Be,{sdk:this.props.sdk,locale:this.props.entitySelectorConfigs.Asset.locale,assetId:i.sys.id,isDisabled:!0,isSelected:!1})),o&&this.renderEntitySelector(r,o))},r.renderEntitySelector=function(e){return n.createElement("div",{className:E.css({marginTop:g.spacingS})},"Entry"===e&&n.createElement(m.TextLink,{onClick:this.selectEntry},"Select entry"),"Asset"===e&&n.createElement(m.TextLink,{onClick:this.selectAsset},"Select asset"))},t}(n.Component);Oe.propTypes={sdk:r.object.isRequired,labels:r.shape({title:r.string,confirm:r.string}),value:r.shape({text:r.string,uri:r.string,target:r.object,type:r.oneOf(["uri","Entry","Asset"])}),entitySelectorConfigs:r.object,allowedHyperlinkTypes:r.arrayOf(r.oneOf(["Entry","Asset","uri"])),hideText:r.bool,onClose:r.func.isRequired},Oe.defaultProps={labels:{title:"Insert link",confirm:"Insert link"},value:{},hideText:!1,entitySelectorConfigs:{},allowedHyperlinkTypes:["Entry","Asset","uri"]};var Ke=function(e,t){var n=t.value,r=!(n.uri||n.target),i={labels:{title:r?"Insert hyperlink":"Edit hyperlink",confirm:r?"Insert":"Update"},value:n,hideText:!t.showTextInput,allowedHyperlinkTypes:t.allowedHyperlinkTypes,entitySelectorConfigs:t.entitySelectorConfigs};return e.openCurrent({title:i.labels.title,width:"large",shouldCloseOnEscapePress:!0,shouldCloseOnOverlayClick:!0,allowHeightOverflow:!0,parameters:K({type:"rich-text-hyperlink-dialog"},i)})},_e=function(e,t){return b((function(e){return S(e,"nodes")}),(function(e){return T(e,["nodes",t])}),(function(e){return S(e,"linkContentType")}),(function(e){return T(e,"linkContentType",[])}))(e.validations)};function Me(e,t){return{entityType:He(t),locale:e.locale||null,contentTypes:_e(e,t)}}function He(e){var t=e.split("-");if(-1!==t.indexOf("entry"))return"Entry";if(-1!==t.indexOf("asset"))return"Asset";throw new Error("RichText node type `"+e+"` has no associated `entityType`")}var qe,je=function(e,t,n){var r=function(e,t){return b((function(e){return S(e,t)}),(function(e){return T(e,t)}))(e.validations)}(e,t);return void 0===r||r.includes(n)},Ue=function(e,t){return je(e,"enabledNodeTypes",t)},Fe=function(e,t){return je(e,"enabledMarks",t)},Ye=u.INLINES.HYPERLINK,Ge=u.INLINES.ENTRY_HYPERLINK,ze=u.INLINES.ASSET_HYPERLINK,We=[Ye,Ge,ze],Ve=((qe={})[u.INLINES.ENTRY_HYPERLINK]="Entry",qe[u.INLINES.ASSET_HYPERLINK]="Asset",qe[u.INLINES.HYPERLINK]="uri",qe);function Qe(e){var t=[u.INLINES.ENTRY_HYPERLINK,u.INLINES.ASSET_HYPERLINK,u.INLINES.HYPERLINK];return"RichText"===e.type?t.filter((function(t){return Ue(e,t)})).map((function(e){return Ve[e]})):t.map((function(e){return Ve[e]}))}function Xe(e){var t={};return Ue(e,u.INLINES.ENTRY_HYPERLINK)&&(t.Entry=Me(e,"entry-hyperlink")),Ue(e,u.INLINES.ASSET_HYPERLINK)&&(t.Asset=Me(e,"asset-hyperlink")),t}function Je(e){return!e.isExpanded&&$e(e)}function $e(e){return We.some((function(t){return ne({value:e},t)}))}function Ze(e){return e.inlines.every((function(e){return We.includes(e.type)}))}function et(e,t,n){return tt.apply(this,arguments)}function tt(){return(tt=O(Re.mark((function e(t,n,r){return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!$e(t.value)){e.next=4;break}it(t,r),e.next=6;break;case 4:return e.next=6,nt(t,n,r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nt(e,t,n){return rt.apply(this,arguments)}function rt(){return(rt=O(Re.mark((function e(t,n,r){var i,o,s,a,c,l,d;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.blur(),r("openCreateHyperlinkDialog"),i=!t.value.isExpanded||""===t.value.fragment.text.trim(),e.next=5,Ke(n.dialogs,{showTextInput:i,value:{text:t.value.fragment.text||""},allowedHyperlinkTypes:Qe(n.field),entitySelectorConfigs:Xe(n.field)});case 5:if(o=e.sent){e.next=10;break}return r("cancelCreateHyperlinkDialog"),t.focus(),e.abrupt("return");case 10:s=o.text,a=o.type,c=o.uri,l=o.target,i&&(t.isVoid(t.value.blocks.last())&&t.insertBlock(u.BLOCKS.PARAGRAPH),t.insertText(s).moveFocusForward(0-s.length)),t.call(at,a,l?{target:l}:{uri:c}),d=ct(a),r("insert",{nodeType:d,linkType:a}),t.focus();case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function it(e,t){We.forEach((function(t){return e.unwrapInline(t)})),e.focus(),t("unlinkHyperlinks")}function ot(e,t,n){return st.apply(this,arguments)}function st(){return(st=O(Re.mark((function e(t,n,r){var i,o,s,a,c,l,u,d,p;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.value.inlines.get(0)){e.next=3;break}throw new Error("Change object contains no link to be edited.");case 3:return t.blur(),r("openEditHyperlinkDialog"),o=i.data.toJSON(),s=o.uri,a=o.target,e.next=8,Ke(n.dialogs,{showTextInput:!1,value:a?{target:a}:{uri:s},allowedHyperlinkTypes:Qe(n.field),entitySelectorConfigs:Xe(n.field)});case 8:if(c=e.sent){e.next=13;break}return r("cancelEditHyperlinkDialog"),t.focus(),e.abrupt("return");case 13:u=c.uri,d=c.target,p=ct(l=c.type),t.setInlines({type:p,data:d?{target:d}:{uri:u}}),r("edit",{nodeType:p,linkType:l}),t.focus();case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function at(e,t,n){e.wrapInline({type:ct(t),data:n}),e.moveToEnd()}function ct(e){switch(e){case"Entry":return Ge;case"Asset":return ze}return Ye}var lt=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).handleClick=se(H(t),O(Re.mark((function e(){var n,r,i,o,s,a;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t.props).onToggle,i=n.editor,s=(o=n.richTextAPI).sdk,a=o.logToolbarAction,e.next=3,et(i,s,a);case 3:r(i);case 4:case"end":return e.stop()}}),e)})))),t}return _(t,e),t.prototype.render=function(){var e=this.props,t=e.editor,r=e.disabled||!Ze(t.value);return n.createElement(J,{disabled:r,type:u.INLINES.HYPERLINK,icon:"Link",title:"Hyperlink",onToggle:this.handleClick,isActive:$e(t.value)})},t}(t.Component);lt.propTypes=X;var ut={entityContentType:E.css({color:g.colorTextLightest,marginRight:g.spacingXs,"&:after":{content:'""'}}),entityTitle:E.css({marginRight:g.spacingXs}),separator:E.css({background:g.colorTextMid,margin:g.spacingXs})},dt={hyperlinkWrapper:E.css({display:"inline",position:"static",a:{fontSize:"inherit !important"}}),hyperlink:E.css({fontSize:"inherit !important",display:"inline !important","&:hover":{fill:g.textColorDark},"&:focus":{fill:g.textColorDark}}),hyperlinkIEFallback:E.css({color:"#1683d0",textDecoration:"underline"}),hyperlinkIcon:E.css({position:"relative",top:"4px",height:"14px",margin:"0 -2px 0 -1px",webkitTransition:"fill 100ms ease-in-out",transition:"fill 100ms ease-in-out","&:hover":{fill:g.textColorDark},"&:focus":{fill:g.textColorDark}})},pt=C.detect(),ft=!(pt&&"ie"===pt.name);function ht(){return(ht=O(Re.mark((function e(t){var n,r,i,o,s,a,c,l,u,d,p,f,h;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.sdk,r=t.entityId,o=t.localeCode,s=t.defaultLocaleCode,c="Entry"===(i=t.entityType)?n.space.getEntry:n.space.getAsset,e.next=4,c(r);case 4:if(!(l=e.sent).sys.contentType){e.next=10;break}return u=l.sys.contentType.sys.id,e.next=9,n.space.getContentType(u);case 9:a=e.sent;case 10:return d="Entry"===i?k.entityHelpers.getEntryTitle({entry:l,contentType:a,localeCode:o,defaultLocaleCode:s,defaultTitle:"Untitled"}):k.entityHelpers.getAssetTitle({asset:l,localeCode:o,defaultLocaleCode:s,defaultTitle:"Untitled"}),p=k.entityHelpers.getEntityDescription({entity:l,contentType:a,localeCode:o,defaultLocaleCode:s}),e.next=14,n.space.getEntityScheduledActions(i,r);case 14:return f=e.sent,h=k.entityHelpers.getEntryStatus(l.sys),e.abrupt("return",{jobs:f,entity:l,entityTitle:d,entityDescription:p,entityStatus:h,contentTypeName:a?a.name:""});case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mt(e){var t=e.statusLabel;return n.createElement(m.Tag,{className:e.className,tagType:{published:"positive",draft:"warning",archived:"negative",changed:"primary"}[t]},t)}function yt(e){var t=e.richTextAPI.sdk,r=e.target,i=n.useState({type:"loading"}),o=i[0],s=i[1];if(n.useEffect((function(){(function(e){return ht.apply(this,arguments)})({sdk:t,entityId:r.sys.id,entityType:r.sys.linkType,localeCode:t.field.locale,defaultLocaleCode:t.locales.default}).then((function(e){s({type:"success",data:e})})).catch((function(e){console.log(e),s({type:"error",error:e})}))}),[]),"loading"===o.type)return"Loading "+r.sys.linkType.toLowerCase()+"...";var a,c,l,u,d,f="";if("error"===o.type)f=r.sys.linkType+" missing or inaccessible";else{var h=o.data,m=h.jobs,y=M(h,["jobs"]);f=n.createElement(n.Fragment,null,(l=(a=y).entityStatus,u=a.contentTypeName,d=((c=a.entityTitle)&&c.length>60?c&&c.substr(0,61).replace(/(\s+\S(?=\S)|\s*)\.?.$/,"â€¦"):c)||"Untitled",n.createElement("div",null,n.createElement("span",{className:ut.entityContentType},u||"Asset"),n.createElement("span",{className:ut.entityTitle},d),n.createElement(mt,{statusLabel:l}))),m.length>0?n.createElement(n.Fragment,null,n.createElement("hr",{className:ut.separator}),n.createElement(p.ScheduleTooltipContent,{job:m[0],jobsCount:m.length})):null)}return f}mt.propTypes={className:r.string,statusLabel:r.string.isRequired};var Et=function(e){function t(){return e.apply(this,arguments)||this}_(t,e);var r=t.prototype;return r.onKeyDown=function(e){y("enter",e)&&(e.preventDefault(),e.stopPropagation(),this.props.onEdit(e))},r.render=function(){var e=this,t=this.props.node,r=t.data.get("uri"),i=t.data.get("target");return n.createElement("span",K({},this.props.attributes,{onClick:this.props.onEdit,onKeyDown:function(t){return e.onKeyDown(t)},role:"button",tabIndex:0}),i?this.renderEntityLink(i):this.renderLink({tooltip:r}))},r.renderLink=function(e){var t,r=e.tooltip,i=this.props,o=i.children,s=i.node,a=s.data.get("title"),c=s.data.get("uri"),l=/^(?:[a-z]+:)?\/\//i.test(t=c)||/^mailto:/i.test(t)?c:"javascript:void(0)";return n.createElement(m.Tooltip,{content:r,className:dt.tooltipContainer,targetWrapperClassName:dt.hyperlinkWrapper,place:"bottom",maxWidth:"auto"},ft?n.createElement(m.TextLink,{href:l,rel:"noopener noreferrer",title:a,className:dt.hyperlink},o):n.createElement("span",{className:E.cx(dt.hyperlink,dt.hyperlinkIEFallback)},o))},r.renderEntityLink=function(e){return this.renderLink({tooltip:n.createElement(yt,{richTextAPI:this.props.richTextAPI,target:e})})},t}(n.Component);Et.propTypes={attributes:r.object.isRequired,node:r.object.isRequired,children:r.node,editor:r.object,richTextAPI:r.object.isRequired,onEdit:r.func},Et.defaultProps={onEdit:s};var gt=u.INLINES.HYPERLINK,vt=u.INLINES.ENTRY_HYPERLINK,bt=u.INLINES.ASSET_HYPERLINK,St=function(e){var t=e.richTextAPI;return{renderNode:function(e,r,i){var o=t.sdk,s=t.logViewportAction,a=e.node,c=e.editor;return Tt(a.type)?n.createElement(Et,K({},e,{richTextAPI:t,onEdit:function(e){e.preventDefault(),c.moveToRangeOfNode(a).focus(),Je(c.value)&&ot(c,o,s)}})):i()},onKeyDown:function(e,n,r){var i=t.sdk,o=t.logShortcutAction;if(!y(["mod+k"],e)||!Ze(n.value))return r();Je(n.value)?ot(n,i,o):et(n,i,o)},normalizeNode:function(e,t,n){if(Tt(e.type)&&e.getInlines().size>0)return function(){e.getInlines().forEach((function(n){return t.unwrapInlineByKey(n.key,e.type)}))};n()}}};function Tt(e){return[gt,vt,bt].includes(e)}var Ct=function(e){return oe({type:u.MARKS.SUBSCRIPT,tagName:"sub",hotkey:["mod+~"],richTextAPI:e.richTextAPI})},kt=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t.prototype.render=function(){return n.createElement(J,this.props)},t}(t.Component),At=ae({type:u.MARKS.SUBSCRIPT,title:"Subscript",icon:"ArrowDown"})(kt),It=function(e){return oe({type:u.MARKS.SUPERSCRIPT,tagName:"sup",hotkey:["mod+^"],richTextAPI:e.richTextAPI})},Lt=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t.prototype.render=function(){return n.createElement(J,this.props)},t}(t.Component),xt=ae({type:u.MARKS.SUPERSCRIPT,title:"Superscript",icon:"ArrowUp"})(Lt),Dt={root:E.css({button:{span:{fontWeight:g.fontWeightDemiBold}}}),h1:E.css({button:{span:{fontSize:"1.625rem"}}}),h2:E.css({button:{span:{fontSize:"1.4375rem"}}}),h3:E.css({button:{span:{fontSize:"1.25rem"}}}),h4:E.css({button:{span:{fontSize:"1.125rem"}}}),h5:E.css({button:{span:{fontSize:"1rem"}}}),h6:E.css({button:{span:{fontSize:"0.875rem"}}})},Nt=function(e){return e.replace("heading-","h")},Rt=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).handleClick=function(e){e.preventDefault(),t.props.onToggle(e)},t}return _(t,e),t.prototype.render=function(){var e=this.props,t=e.type,r=e.children;return n.createElement(m.DropdownListItem,{label:e.title,isActive:e.isActive,"data-test-id":"toolbar-toggle-"+t,className:E.cx(Dt.root,Dt[Nt(t)]),onClick:this.handleClick},r)},t}(t.Component);Rt.propTypes={isActive:r.bool.isRequired,onToggle:r.func.isRequired,title:r.string.isRequired,type:r.string,children:r.node};var wt,Bt,Pt=function(e){var n=e.type,r=e.title,i=e.icon,o=e.applyChange,s=void 0===o?function(e,t){return e.setBlocks(t)}:o;return function(e){var o,a;return a=o=function(o){function a(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=o.call.apply(o,[this].concat(r))||this).handleSelect=se(H(e),(function(){var t=e.props,r=t.editor,i=t.onToggle,o=t.richTextAPI.logToolbarAction;s(r,n),i(r),o("insert",{nodeType:n})})),e}return _(a,o),a.prototype.render=function(){var o=this.props,s=o.disabled;return t.createElement(e,{type:n,icon:i,title:r,onToggle:this.handleSelect,isActive:te(o.editor,n),disabled:s})},a}(t.Component),o.propTypes=X,a}},Ot={root:E.css((wt={width:"110px"},wt["@media (min-width: "+g.contentWidthDefault+")"]={width:"145px"},wt.svg={marginLeft:"auto"},wt["> span"]={padding:"0 2px!important"},wt))},Kt=((Bt={})[u.BLOCKS.HEADING_1]="Heading 1",Bt[u.BLOCKS.HEADING_2]="Heading 2",Bt[u.BLOCKS.HEADING_3]="Heading 3",Bt[u.BLOCKS.HEADING_4]="Heading 4",Bt[u.BLOCKS.HEADING_5]="Heading 5",Bt[u.BLOCKS.HEADING_6]="Heading 6",Bt[u.BLOCKS.PARAGRAPH]="Normal Text",Bt[u.BLOCKS.EMBEDDED_ENTRY]="Embedded Entry",Bt[u.BLOCKS.EMBEDDED_ASSET]="Embedded Asset",Bt),_t=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).getStyleNameForChange=function(){return Kt[t.props.currentBlockType]||Kt[u.BLOCKS.PARAGRAPH]},t}return _(t,e),t.prototype.render=function(){var e=this.props,t=e.isOpen,r=e.onClose,i=e.children;return n.createElement(m.Dropdown,{toggleElement:n.createElement(m.Button,{onClick:e.onToggle,"data-test-id":"toolbar-heading-toggle",className:Ot.root,indicateDropdown:!0,buttonType:"naked",size:"small",disabled:this.props.disabled},this.getStyleNameForChange()),isOpen:t,onClose:r},n.createElement(m.DropdownList,{className:"toolbar-heading-dropdown-list"},i))},t}(t.Component);function Mt(e){var r=Kt[e],i=function(t){function i(){return t.apply(this,arguments)||this}return _(i,t),i.prototype.render=function(){return n.createElement(Rt,K({},this.props,{"data-test-id":e}),r)},i}(t.Component);return i.displayName=r.replace(/\s/g,""),Pt({type:e,title:r})(i)}_t.propTypes={children:r.node.isRequired,isOpen:r.bool,disabled:r.bool,onClose:r.func,onToggle:r.func,currentBlockType:r.string};var Ht=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t.prototype.render=function(){return n.createElement(Rt,this.props,Kt[u.BLOCKS.PARAGRAPH])},t}(t.Component),qt=Pt({type:u.BLOCKS.PARAGRAPH,title:Kt[u.BLOCKS.PARAGRAPH],shouldToggle:!1})(Ht),jt=function(e,t,n){return function(r){var i=r.type,o=void 0===i?e:i,s=r.richTextAPI;return{renderNode:function(e,n,r){return e.node.type===o?Ie(t,{})(e):r()},onKeyDown:function(e,t,r){if(y("enter",e)){if(t.value.blocks.get(0).type===o){var i=t.value;if(0===i.selection.start.offset){var a=i.selection;t.splitBlock().setBlocksAtRange(a,u.BLOCKS.PARAGRAPH)}else t.splitBlock().setBlocks(u.BLOCKS.PARAGRAPH);return}}else if(y(n,e)){var c=ve(t,o);return void s.logShortcutAction(c?"insert":"remove",{nodeType:o})}return r()}}}},Ut=jt(u.BLOCKS.HEADING_1,"h1",["mod+opt+1"]),Ft=jt(u.BLOCKS.HEADING_2,"h2",["mod+opt+2"]),Yt=jt(u.BLOCKS.HEADING_3,"h3",["mod+opt+3"]),Gt=jt(u.BLOCKS.HEADING_4,"h4",["mod+opt+4"]),zt=jt(u.BLOCKS.HEADING_5,"h5",["mod+opt+5"]),Wt=jt(u.BLOCKS.HEADING_6,"h6",["mod+opt+6"]),Vt=Mt(u.BLOCKS.HEADING_1),Qt=Mt(u.BLOCKS.HEADING_2),Xt=Mt(u.BLOCKS.HEADING_3),Jt=Mt(u.BLOCKS.HEADING_4),$t=Mt(u.BLOCKS.HEADING_5),Zt=Mt(u.BLOCKS.HEADING_6);function en(e,t,n,r){return tn.apply(this,arguments)}function tn(){return(tn=O(Re.mark((function e(t,n,r,i){var o,s,a,c,l;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i("openCreateEmbedDialog",{nodeType:t}),o=n.dialogs,s=Me(n.field,t),a="Asset"===s.entityType?o.selectSingleAsset:o.selectSingleEntry,c=K({},s,{withCreate:!0}),e.prev=5,e.next=8,a(c);case 8:if(l=e.sent){e.next=11;break}return e.abrupt("return");case 11:nn(r,t,l),i("insert",{nodeType:t}),e.next=22;break;case 15:if(e.prev=15,e.t0=e.catch(5),!e.t0){e.next=21;break}throw e.t0;case 21:i("cancelCreateEmbedDialog",{nodeType:t});case 22:case"end":return e.stop()}}),e,null,[[5,15]])})))).apply(this,arguments)}function nn(e,t,n,r){void 0===r&&(r=!0);var i=function(e,t){return{type:e,object:"block",data:{target:{sys:{id:t.sys.id,type:"Link",linkType:t.sys.type}}}}}(t,n);0===e.value.blocks.size||re(e)?e.insertBlock(i):e.setBlocks(i),r&&e.insertBlock(u.BLOCKS.PARAGRAPH).focus()}var rn=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).handleClick=function(e){t.props.onCloseEmbedMenu(),t.handleAction(e)},t.handleAction=se(H(t),O(Re.mark((function e(){var n,r,i,o,s,a;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t.props).editor,i=n.nodeType,s=(o=n.richTextAPI).sdk,a=o.logToolbarAction,e.next=3,en(i,s,r,a);case 3:t.props.onToggle(r);case 4:case"end":return e.stop()}}),e)})))),t}return _(t,e),t.prototype.render=function(){var e=this.props.nodeType,t=function(e){var t=e.toLowerCase().split("-");if(t.includes("entry"))return"Entry";if(t.includes("asset"))return"Asset";throw new Error("Node type `"+e+"` has no associated `entityType`")}(e),r="rich-text__"+e;return this.props.isButton?n.createElement(m.Button,{disabled:this.props.disabled,className:r+"-button",size:"small",onClick:this.handleClick,icon:"Asset"===t?"Asset":"EmbeddedEntryBlock",buttonType:"muted",testId:"toolbar-toggle-"+e},"Embed "+t.toLowerCase()):n.createElement(m.DropdownListItem,{isDisabled:this.props.disabled,className:r+"-list-item",size:"small",onClick:this.handleClick,testId:"toolbar-toggle-"+e},n.createElement("div",{className:"cf-flex-grid"},n.createElement(m.Icon,{icon:"Asset"===t?"Asset":"EmbeddedEntryBlock",className:"rich-text__embedded-entry-list-icon",color:"secondary"}),t))},t}(t.Component);rn.propTypes=K({},X,{isButton:r.bool}),rn.defaultProps={isButton:!1};var on={root:E.css({marginBottom:"1.25rem"})},sn=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).handleEditClick=function(){var e=t.getEntitySys(),n=t.props.sdk.navigator;return("Asset"===e.type?n.openAsset:n.openEntry)(e.id,{slideIn:!0})},t.handleRemoveClick=function(){var e=t.props,n=e.editor,r=e.node;n.moveToRangeOfNode(r),n.removeNodeByKey(r.key),n.focus()},t}_(t,e);var r=t.prototype;return r.getEntitySys=function(){var e=this.props.node.data;return{id:e.get("target").sys.id,type:e.get("target").sys.linkType}},r.render=function(){var e=this.props,t=e.sdk,r=e.editor,i=e.isSelected,o=r.props.readOnly||r.props.actionsDisabled,s=this.getEntitySys(),a=s.id,c=s.type;return n.createElement("div",K({},this.props.attributes,{className:on.root}),"Entry"===c&&n.createElement(we,{sdk:t,entryId:a,locale:t.field.locale,isDisabled:o,isSelected:i,onRemove:this.handleRemoveClick,onEdit:this.handleEditClick,getEntryUrl:function(){var e=t.parameters.instance.getEntryUrl;return"function"==typeof e?e(a):""},onEntityFetchComplete:this.props.onEntityFetchComplete}),"Asset"===c&&n.createElement(Be,{sdk:t,assetId:a,locale:t.field.locale,isDisabled:o,isSelected:i,onRemove:this.handleRemoveClick,onEdit:this.handleEditClick,getAssetUrl:function(){var e=t.parameters.instance.getAssetUrl;return"function"==typeof e?e(a):""},onEntityFetchComplete:this.props.onEntityFetchComplete}))},t}(n.Component);sn.propTypes={sdk:r.object.isRequired,isSelected:r.bool.isRequired,attributes:r.object.isRequired,editor:r.object.isRequired,node:r.object.isRequired,onEntityFetchComplete:r.func.isRequired};var an=function(e){var t=e.richTextAPI,r=t.sdk,i=t.logShortcutAction,o=t.logViewportAction,s=e.nodeType,a=e.hotkey;return{renderNode:function(e,t,i){var a=e.key;return e.node.type===s?n.createElement(sn,K({sdk:r},e,e.attributes,{onEntityFetchComplete:function(){o("linkRendered",{key:a})}})):i()},onKeyDown:function(e,t,n){if(a&&y(a,e))en(s,r,t,i);else{if(!y("enter",e)||!function(e,t){return e.value.blocks.get(0).type===t}(t,s))return n();t.insertBlock(u.BLOCKS.PARAGRAPH).focus()}}}},cn=function(e){return{type:u.INLINES.EMBEDDED_ENTRY,object:"inline",data:{target:{sys:{id:e,type:"Link",linkType:"Entry"}}}}},ln=function(e,t,n){void 0===n&&(n=!0),ne(e,u.INLINES.EMBEDDED_ENTRY)?e.setInlines(cn(t)):e.insertInline(cn(t)),n&&e.moveToStartOfNextText().focus()},un=function(){var e=O(Re.mark((function e(t,n,r){var i,o,s,a,c;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r("openCreateEmbedDialog",{nodeType:i=u.INLINES.EMBEDDED_ENTRY}),o=t.dialogs,s=Me(t.field,i),a=K({},s,{withCreate:!0}),e.prev=5,e.next=8,o.selectSingleEntry(a);case 8:if(c=e.sent){e.next=11;break}return e.abrupt("return");case 11:ln(n,c.sys.id),r("insert",{nodeType:i}),e.next=22;break;case 15:if(e.prev=15,e.t0=e.catch(5),!e.t0){e.next=21;break}throw e.t0;case 21:r("cancelCreateEmbedDialog",{nodeType:i});case 22:case"end":return e.stop()}}),e,null,[[5,15]])})));return function(t,n,r){return e.apply(this,arguments)}}(),dn=function(e){return!(e.value.inlines.size>0)||(t=u.INLINES.EMBEDDED_ENTRY,(n=e.value).inlines.size>0&&n.inlines.every((function(e){return e.type===t})));var t,n},pn=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).handleClick=function(e){t.props.onCloseEmbedMenu(),t.handleAction(e)},t.handleAction=se(H(t),O(Re.mark((function e(){var n,r,i,o,s;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t.props).editor,o=(i=n.richTextAPI).sdk,s=i.logToolbarAction,e.next=3,un(o,r,s);case 3:t.props.onToggle(r);case 4:case"end":return e.stop()}}),e)})))),t}return _(t,e),t.prototype.render=function(){var e=this;return this.props.isButton?n.createElement(m.Button,{disabled:this.props.disabled,className:u.INLINES.EMBEDDED_ENTRY+"-button",size:"small",onClick:function(t){return e.handleClick(t)},icon:"EmbeddedEntryInline",buttonType:"muted",testId:"toolbar-toggle-"+u.INLINES.EMBEDDED_ENTRY},"Embed inline entry"):n.createElement(m.DropdownListItem,{isDisabled:this.props.disabled||!dn(this.props.editor),className:"rich-text__entry-link-block-button",size:"small",icon:"Entry",testId:"toolbar-toggle-"+u.INLINES.EMBEDDED_ENTRY,onClick:this.handleClick},n.createElement("div",{className:"cf-flex-grid"},n.createElement(m.Icon,{icon:"EmbeddedEntryInline",color:"secondary",className:"rich-text__embedded-entry-list-icon"}),"Inline entry"))},t}(t.Component);pn.propTypes=X,pn.defaultProps={isButton:!1};var fn=k.entityHelpers.getEntryTitle,hn=k.entityHelpers.getEntryStatus,mn={scheduledIcon:E.css({verticalAlign:"text-bottom",marginRight:g.spacing2Xs})},yn=function(e){var t=p.useEntities(),r=t.loadEntry,i=t.entries;n.useEffect((function(){r(e.entryId)}),[e.entryId]);var o=i[e.entryId];if(n.useEffect((function(){o&&e.onEntityFetchComplete&&e.onEntityFetchComplete()}),[o]),"failed"===o)return n.createElement(m.InlineEntryCard,{testId:u.INLINES.EMBEDDED_ENTRY,selected:e.isSelected},"Entry missing or inaccessible");if(void 0===o)return n.createElement(m.InlineEntryCard,{loading:!0});var s=e.sdk.space.getCachedContentTypes().find((function(e){return e.sys.id===o.sys.contentType.sys.id})),a=s?s.name:"",c=hn(o.sys);if("deleted"===c)return n.createElement(m.InlineEntryCard,{testId:u.INLINES.EMBEDDED_ENTRY,onRemove:e.onRemove,selected:e.isSelected},"Entry missing or inaccessible");var l=fn({entry:o,contentType:s,localeCode:e.sdk.field.locale,defaultLocaleCode:e.sdk.locales.default,defaultTitle:"Untitled"});return n.createElement(m.InlineEntryCard,{testId:u.INLINES.EMBEDDED_ENTRY,selected:e.isSelected,title:a+": "+l,status:c,dropdownListElements:e.isReadOnly?null:n.createElement(m.DropdownList,null,n.createElement(m.DropdownListItem,{onClick:e.onEdit},"Edit"),n.createElement(m.DropdownListItem,{onClick:e.onRemove,isDisabled:e.isDisabled},"Remove"))},n.createElement(p.ScheduledIconWithTooltip,{getEntityScheduledActions:e.sdk.space.getEntityScheduledActions,entityType:"Entry",entityId:o.sys.id},n.createElement(m.Icon,{className:mn.scheduledIcon,icon:"Clock",color:"muted",testId:"scheduled-icon"})),l)};yn.propTypes={sdk:r.object.isRequired,entryId:r.string.isRequired,isDisabled:r.bool.isRequired,isSelected:r.bool.isRequired,isReadOnly:r.bool.isRequired,onRemove:r.func.isRequired,onEdit:r.func.isRequired,onEntityFetchComplete:r.func};var En={root:E.css({margin:"0px 5px",fontSize:"inherit",span:{webkitUserSelect:"none",mozUserSelect:"none",msUserSelect:"none",userSelect:"none"}})},gn=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).handleEditClick=function(){var e=t.getEntitySys();return t.props.sdk.navigator.openEntry(e.id,{slideIn:!0})},t.handleRemoveClick=function(){var e=t.props;e.editor.removeNodeByKey(e.node.key)},t}_(t,e);var r=t.prototype;return r.getEntitySys=function(){var e=this.props.node.data;return{id:e.get("target").sys.id,type:e.get("target").sys.linkType}},r.render=function(){var e=this.props,t=e.sdk,r=e.editor,i=e.isSelected,o=r.props.readOnly,s=r.props.actionsDisabled,a=this.getEntitySys().id;return n.createElement("span",K({},this.props.attributes,{className:En.root}),n.createElement(yn,{sdk:t,entryId:a,isSelected:i,isDisabled:o,isReadOnly:s,onRemove:this.handleRemoveClick,onEdit:this.handleEditClick,onEntityFetchComplete:this.props.onEntityFetchComplete}))},t}(n.Component);gn.propTypes={sdk:r.object.isRequired,isSelected:r.bool.isRequired,attributes:r.object.isRequired,editor:r.object.isRequired,node:r.object.isRequired,onEntityFetchComplete:r.func.isRequired};var vn=function(e){var t=e.richTextAPI,r=t.sdk,i=t.logShortcutAction,o=t.logViewportAction;return{renderNode:function(e,t,i){var s=e.key;return e.node.type===u.INLINES.EMBEDDED_ENTRY?n.createElement(gn,K({sdk:r},e,e.attributes,{onEntityFetchComplete:function(){o("linkRendered",{key:s})}})):i()},onKeyDown:function(e,t,n){if(!y(["mod+shift+2"],e)||!dn(t))return y("enter",e)&&function(e){var t=e.value.inlines,n=e.value.selection;if(1===t.size&&n.start.key===n.end.key)return t.get(0).type===u.INLINES.EMBEDDED_ENTRY}(t)?(e.preventDefault(),void t.moveToStartOfNextText()):n();un(r,t,i)}}},bn=function(e,t,n){var r=Y(),i=r.utils,o=r.changes,s=o.unwrapList,a=o.wrapInList;if(i.isSelectionInList(e.value))if(i.getCurrentList(e.value).type!==t){var c=i.getCurrentList(e.value);e.setNodeByKey(c.key,t),n("insert",{nodeType:t})}else s(e),n("remove",{nodeType:t});else a(e,t),n("insert",{nodeType:t});return e.focus()},Sn=function(e,t){var n=Y().utils.getCurrentList(e.value);return!!n&&n.type===t},Tn=function(e){var n=e.type,r=e.title,i=e.icon;return function(e){var o,s;return s=o=function(o){function s(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=o.call.apply(o,[this].concat(r))||this).handleToggle=se(H(e),(function(){var t=e.props,r=t.editor,i=t.onToggle;bn(r,n,t.richTextAPI.logToolbarAction),i(r)})),e}return _(s,o),s.prototype.render=function(){return t.createElement(e,{type:n,icon:i,title:r,onToggle:this.handleToggle,isActive:Sn(this.props.editor,n),disabled:this.props.disabled})},s}(t.Component),o.propTypes=X,s}},Cn=Tn({type:u.BLOCKS.UL_LIST,title:"UL",icon:"ListBulleted"})((function(e){return n.createElement(J,e)})),kn=Tn({type:u.BLOCKS.OL_LIST,title:"OL",icon:"ListNumbered"})((function(e){return n.createElement(J,e)}));function An(){var e=q(["\n    &::after {\n      background: ",";\n      -webkit-box-shadow: 0px 0px 5px ",";\n      box-shadow: 0px 0px 5px ",";\n    }\n  "]);return An=function(){return e},e}function In(){var e=q(["\n    height: ",";\n    background: transparent;\n    position: relative;\n    margin: 0 0 ",";\n    &:hover {\n      cursor: pointer;\n    }\n    &::after {\n      content: '';\n      position: absolute;\n      width: 100%;\n      height: 1px;\n      background: ",";\n      top: 50%;\n    }\n  "]);return In=function(){return e},e}var Ln={hr:E.css(In(),g.spacingM,g.spacingL,g.colorElementMid),hrSelected:E.css(An(),g.colorPrimary,g.colorPrimary,g.colorPrimary)},xn=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t.prototype.render=function(){return n.createElement(J,this.props)},t}(t.Component),Dn=Pt({type:u.BLOCKS.HR,title:"HR",icon:"HorizontalRule",applyChange:function(e,t){var n={type:t,object:"block"};0===e.value.blocks.size||re(e)?e.insertBlock(n):e.setBlocks(n),e.insertBlock(u.BLOCKS.PARAGRAPH).focus()}})(xn),Nn=function(e){var t=d.toContentfulDocument({document:e.value.document.toJSON(),schema:W});return I.documentToPlainTextString(t).length},Rn=function(e){var t=e.richTextAPI.logShortcutAction;return{onPaste:function(e,n,r){var i=global.getSelection().toString().length,o=Nn(n);setTimeout((function(){var e=Nn(n);t("paste",{characterCountAfter:e,characterCountBefore:o,characterCountSelection:i})})),r()}}},wn={p:u.BLOCKS.PARAGRAPH,ul:u.BLOCKS.UL_LIST,ol:u.BLOCKS.OL_LIST,blockquote:u.BLOCKS.QUOTE,hr:u.BLOCKS.HR,h1:u.BLOCKS.HEADING_1,h2:u.BLOCKS.HEADING_2,h3:u.BLOCKS.HEADING_3,h4:u.BLOCKS.HEADING_4,h5:u.BLOCKS.HEADING_5,h6:u.BLOCKS.HEADING_6},Bn={strong:u.MARKS.BOLD,b:u.MARKS.BOLD,em:u.MARKS.ITALIC,i:u.MARKS.ITALIC,u:u.MARKS.UNDERLINE,sup:u.MARKS.SUPERSCRIPT,sub:u.MARKS.SUBSCRIPT,code:u.MARKS.CODE},Pn=[{deserialize:function(e,t){if(e.ownerDocument.querySelector("[id*=docs-internal-guid-]")){if(function(e){return"b"===e.tagName.toLowerCase()&&e.id.startsWith("docs-internal-guid-")}(e))return t(e.childNodes);if("span"===e.tagName.toLowerCase()){var n=[];return function(e){return"700"===e.style.fontWeight}(e)&&n.push(u.MARKS.BOLD),function(e){return"italic"===e.style.fontStyle}(e)&&n.push(u.MARKS.ITALIC),function(e){return"underline"===e.style.textDecoration}(e)&&n.push(u.MARKS.UNDERLINE),{object:"text",leaves:[{object:"leaf",text:e.textContent,marks:n.map((function(e){return{object:"mark",type:e}}))}]}}}}},{deserialize:function(e,t){if("li"===e.tagName.toLowerCase()){var n=t(e.childNodes);return n=n.map((function(e){return"text"===e.object?{object:"block",type:u.BLOCKS.PARAGRAPH,nodes:[e]}:e})),{object:"block",type:u.BLOCKS.LIST_ITEM,nodes:n}}}},{deserialize:function(e,t){if("a"===e.tagName.toLowerCase())return e.getAttribute("href")?{object:"inline",type:u.INLINES.HYPERLINK,nodes:t(e.childNodes),data:{uri:e.getAttribute("href")}}:t(e.childNodes)}},{deserialize:function(e){if("br"===e.tagName.toLowerCase()&&e.classList.contains("Apple-interchange-newline"))return null}},{deserialize:function(e,t){var n=Bn[e.tagName.toLowerCase()];if(n)return{object:"mark",type:n,nodes:t(e.childNodes)}}},{deserialize:function(e,t){var n=wn[e.tagName.toLowerCase()];if(n){var r=t(e.childNodes);return{object:"block",type:n,nodes:r.length>0?r:[{object:"text"}]}}}}],On=function(e){if(!e.value.startText)return null;var t=e.value.startText.text.slice(0,e.value.selection.start.offset),n=/\/(\S*)$/.exec(t);return null===n?null:n[1]||n[0]},Kn=function(e,t,n){void 0===n&&(n=1),e.removeTextByKey(e.value.selection.start.key,e.value.selection.start.offset-(t.length+n),t.length+n)};function _n(e,t){return Mn.apply(this,arguments)}function Mn(){return(Mn=O(Re.mark((function e(t,n){return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n=""),e.next=3,t.space.getAssets({query:n});case 3:return e.abrupt("return",e.sent.items.map((function(e){return{contentTypeName:"Asset",displayTitle:e.fields.title?e.fields.title[t.field.locale]:"Untitled",id:e.sys.id,entry:e,thumbnail:e.fields.file&&e.fields.file[t.field.locale]&&e.fields.file[t.field.locale].url+"?h=30"}})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Hn(e,t,n){return qn.apply(this,arguments)}function qn(){return(qn=O(Re.mark((function e(t,n,r){return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r=""),e.next=3,t.space.getEntries({content_type:n.sys.id,query:r});case 3:return e.abrupt("return",Promise.all(e.sent.items.map(function(){var e=O(Re.mark((function e(r){var i,o;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=k.entityHelpers.getEntityDescription({contentType:n,entity:r,localeCode:t.field.locale,defaultLocaleCode:t.locales.default}),o=k.entityHelpers.getEntryTitle({entry:r,contentType:n,localeCode:t.field.locale,defaultLocaleCode:t.locales.default,defaultTitle:"Untitled"}),e.abrupt("return",{contentTypeName:n.name,displayTitle:o,id:r.sys.contentType.sys.id,description:i,entry:r});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var jn=function(e,t,n){if(0===e.validations.length)return!0;var r=e.validations.filter((function(e){return e.nodes}))[0].nodes;return void 0===r[n]||!!r[n].filter((function(e){return e.linkContentType})).reduce((function(e,t){return[].concat(e,[t.linkContentType])}),[]).reduce((function(e,t){return[].concat(e,t)}),[]).find((function(e){return e===t.sys.id}))},Un=function(){function e(e){this.sdk=e}var t=e.prototype;return t.maybeBuildEmbedAction=function(e,t,n){return!!Ue(this.sdk.field,e)&&!(t&&!jn(this.sdk.field,t,e))&&Fn(e,t,"embed",n)},t.maybeBuildCreateAndEmbedAction=function(){var e=O(Re.mark((function e(t,n,r){return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ue(this.sdk.field,t)){e.next=2;break}return e.abrupt("return",!1);case 2:if(!n){e.next=13;break}if(jn(this.sdk.field,n,t)){e.next=6;break}return e.abrupt("return",!1);case 6:return e.next=8,this.sdk.access.can("create",{sys:{type:"Entry",contentType:{sys:n.sys}}});case 8:if(!1!==e.sent){e.next=11;break}return e.abrupt("return",!1);case 11:e.next=18;break;case 13:return e.next=15,this.sdk.access.can("create","Asset");case 15:if(!1!==e.sent){e.next=18;break}return e.abrupt("return",!1);case 18:return e.abrupt("return",Fn(t,n,"create_embed",r));case 19:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),e}();function Fn(e,t,n,r){var i=!t,o=e===u.INLINES.EMBEDDED_ENTRY;return{label:("embed"===n?"Embed":"Create and embed")+" "+(i?"Asset":t.name)+" "+(o?" - Inline":""),group:i?"Assets":t.name,callback:r,icon:o?"EmbeddedEntryInline":"EmbeddedEntryBlock"}}var Yn={commandPanel:E.css({display:"block",background:g.colorWhite,boxShadow:"0 2px 5px rgba(0, 0, 0, 0.1), 0 5px 10px -5px rgba(0, 0, 0, 0.3)",border:"1px solid "+g.colorElementDark,borderRadius:"3px",fontFamily:g.fontStackPrimary,width:"500px",overflowY:"auto"}),commandPanelList:E.css({display:"block",listStyle:"none",margin:0,padding:0,height:"200px",overflowY:"auto"}),item:E.css({fontSize:g.fontSizeM,lineHeight:g.lineHeightDefault,padding:g.spacingS+" "+g.spacingXs,borderBottom:"1px solid "+g.colorElementMid,margin:0,color:g.colorTextDark}),divider:E.css({fontWeight:g.fontWeightDemiBold,padding:g.spacingS+" "+g.spacingXs,letterSpacing:g.letterSpacingWide,fontSize:g.fontSizeS,textTransform:"uppercase",borderBottom:"1px solid "+g.colorElementDark,margin:0,lineHeight:g.lineHeightDefault,color:g.colorTextDark}),icon:E.css({marginRight:10}),isSelected:E.css({background:g.colorElementLight}),skeletonContainer:E.css({padding:g.spacingM,height:200,margin:0}),button:E.css({textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",width:"100%",display:"flex",alignItems:"center",border:"none",background:"transparent",fontSize:g.fontSizeM}),navBar:E.css({display:"flex",bottom:0,background:g.colorElementLightest,padding:g.spacingS+" "+g.spacingXs,width:"100%"}),loader:E.css({marginLeft:"auto"}),thumbnail:E.css({marginRight:15}),instruction:E.css({marginRight:15,color:g.colorTextLight}),closeButton:E.css({marginLeft:"auto"})},Gn=r.shape({label:r.string,callback:r.func}),zn=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).listItemRef=null,t}_(t,e);var r=t.prototype;return r.componentDidUpdate=function(){this.props.isSelected&&this.listItemRef.scrollIntoView({block:"nearest",inline:"start"})},r.render=function(){var e=this,t=this.props,r=t.item;return n.createElement("li",{key:t.index,className:t.classNames,ref:function(t){e.listItemRef=t}},n.createElement("button",{type:"button",className:Yn.button,onClick:r.callback&&r.callback},r.icon&&n.createElement(m.Icon,{className:Yn.icon,icon:r.icon,color:"secondary"}),r.thumbnail&&n.createElement("img",{className:Yn.thumbnail,src:r.thumbnail,alt:""}),r.label))},t}(n.Component);zn.propTypes={isSelected:r.bool,index:r.number,classNames:r.string,item:Gn};var Wn=function(e){return n.createElement("span",{className:Yn.instruction},e.children)};Wn.propTypes={children:r.node};var Vn=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).state={selectedKey:0,items:[]},t.handleKeyboard=function(e){if(y("up",e)){if(0===t.state.selectedKey)return;t.setState((function(e){return{selectedKey:e.selectedKey-1}}))}if(y("down",e)){if(t.state.selectedKey===t.state.items.length-1)return;t.setState((function(e){return{selectedKey:e.selectedKey+1}}))}if(y("enter",e)){var n=t.state.items[t.state.selectedKey];n&&n.callback&&n.callback()}},t.renderNavigationBar=function(){return n.createElement("div",{className:Yn.navBar},n.createElement(m.SectionHeading,null,t.props.breadcrumb?"Embed "+t.props.breadcrumb:"Richtext Commands"),n.createElement(m.IconButton,{label:"Close",className:Yn.closeButton,iconProps:{icon:"Close"},buttonType:"muted",onClick:t.props.onClose}))},t.renderStatusBar=function(){return n.createElement("div",{className:Yn.navBar},n.createElement("span",{className:Yn.instructions},n.createElement(Wn,null,"â†‘ â†“ to navigate"),n.createElement(Wn,null,"â†µ to confirm"),n.createElement(Wn,null,"esc to close")),t.props.isUpdating&&n.createElement("span",{className:Yn.loader},"loading ",n.createElement(m.Spinner,{size:"small"})))},t.renderSkeleton=function(){return n.createElement("li",{className:Yn.skeletonContainer},n.createElement(m.SkeletonContainer,null,n.createElement(m.SkeletonBodyText,{numberOfLines:7})))},t}_(t,e),t.getDerivedStateFromProps=function(e,t){var n=e.items!==t.originalItems,r=e.searchString!==t.originalSearchString,i=e.items.filter((function(t){return t.label.toLowerCase().includes(e.searchString?e.searchString.toLowerCase():"")}));return{originalItems:e.items,originalSearchString:e.searchString,items:i,selectedKey:n||r?0:t.selectedKey}};var r=t.prototype;return r.componentDidMount=function(){this.props.richTextAPI.logViewportAction("openRichTextCommandsPalette"),document.addEventListener("keydown",this.handleKeyboard,!0)},r.componentWillUnmount=function(){this.props.richTextAPI.logViewportAction("cancelRichTextCommandsPalette"),document.removeEventListener("keydown",this.handleKeyboard,!0)},r.renderGroups=function(){var e=this,t=B(this.state.items.map((function(e){return e.group})),(function(e){return e}));return t.length?t.map((function(t,r){return n.createElement(n.Fragment,{key:r},t&&n.createElement("li",{key:t,className:Yn.divider},t),e.renderItems(t))})):n.createElement("li",{className:Yn.item},"No results")},r.renderItems=function(e){var t=this;return this.state.items.filter((function(t){return t.group===e})).map((function(e){var r,i=t.state.items.indexOf(e),o=i===t.state.selectedKey,s=w(Yn.item,((r={})[Yn.isSelected]=o,r));return n.createElement(zn,{item:e,classNames:s,key:i,isSelected:o})}))},r.render=function(){var e=this.props,t=e.testId,r=e.isLoading,i=w(Yn.commandPanel,e.className);return n.createElement("div",{className:i},this.renderNavigationBar(),n.createElement("ul",{className:Yn.commandPanelList,"data-test-id":t},r?this.renderSkeleton():this.renderGroups()),this.renderStatusBar())},t}(n.Component);Vn.propTypes={items:r.arrayOf(Gn),searchString:r.string,className:r.string,testId:r.string,isLoading:r.bool,isUpdating:r.bool,breadcrumb:r.string,richTextAPI:r.object,onClose:r.func},Vn.defaultProps={className:void 0,searchString:"",items:[],testId:"cf-ui-command-panel",isLoading:!0,isUpdating:!1};var Qn={top:0,left:0},Xn=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).state={anchorPosition:Qn,items:[],isLoading:!0,panelPosition:"bottom"},t.paletteDimensions={height:300,width:300},t.bindEventListeners=function(){document.addEventListener("scroll",t.handleScroll,!0),document.addEventListener("keydown",t.handleKeyboard,!0),document.addEventListener("click",t.handleOutsideClick,!0)},t.removeEventListeners=function(){document.removeEventListener("scroll",t.handleScroll,!0),document.removeEventListener("keydown",t.handleKeyboard,!0),document.removeEventListener("click",t.handleOutsideClick,!0)},t.handleOutsideClick=function(e){t.palette.contains(e.target)||t.setState({isClosed:!0})},t.requestUpdate=N((function(){t.state.currentCommand&&(t.setState({isUpdating:!0}),t.createCommands(t.state.currentCommand.contentType,t.state.currentCommand.type,t.props.command))}),1e3,{leading:!0,trailing:!1}),t.createCommand=function(e,n,r,i,o,s){return{label:e+(o?" - "+o:""),thumbnail:s,contentType:n,callback:function(){var e=t.props,n=e.editor,o=e.richTextAPI.logCommandPaletteAction;switch(Kn(n,e.command),i){case u.INLINES.EMBEDDED_ENTRY:ln(n,r.sys.id,!1),o("insert",{nodeType:u.INLINES.EMBEDDED_ENTRY});break;case u.BLOCKS.EMBEDDED_ASSET:nn(n,u.BLOCKS.EMBEDDED_ASSET,r,!1),o("insert",{nodeType:u.BLOCKS.EMBEDDED_ASSET});break;default:nn(n,u.BLOCKS.EMBEDDED_ENTRY,r,!1),o("insert",{nodeType:u.BLOCKS.EMBEDDED_ENTRY})}}}},t.onCreateAndEmbedEntity=function(){var e=O(Re.mark((function e(n,r){var i,o,s,a,c,l,d,p,f,h,m,y,E,g;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(o=(i=t.props).richTextAPI).sdk,Kn(s=i.editor,i.command),l=(c=a.space).createAsset,d=c.createEntry,p=null===n,f=function(){return p?l({}):d(n,{})},e.next=8,f();case 8:return y=(m=(h=e.sent).sys).id,E=m.type,r===u.INLINES.EMBEDDED_ENTRY?ln(s,h.sys.id,!1):nn(s,r,h),o.logCommandPaletteAction("insert",{nodeType:r}),g=a.navigator,e.abrupt("return",("Asset"===E?g.openAsset:g.openEntry)(y,{slideIn:!0}));case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),t.createContentTypeActions=function(){var e=O(Re.mark((function e(n,r){return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.maybeBuildEmbedAction(u.BLOCKS.EMBEDDED_ENTRY,r,(function(){t.setState({breadcrumb:r.name,isLoading:!0}),t.createCommands(r),t.clearCommand()})),n.maybeBuildEmbedAction(u.INLINES.EMBEDDED_ENTRY,r,(function(){t.setState({breadcrumb:r.name,isLoading:!0}),t.createCommands(r,u.INLINES.EMBEDDED_ENTRY),t.clearCommand()})),n.maybeBuildCreateAndEmbedAction(u.BLOCKS.EMBEDDED_ENTRY,r,(function(){return t.onCreateAndEmbedEntity(r.sys.id,u.BLOCKS.EMBEDDED_ENTRY)})),n.maybeBuildCreateAndEmbedAction(u.INLINES.EMBEDDED_ENTRY,r,(function(){return t.onCreateAndEmbedEntity(r.sys.id,u.INLINES.EMBEDDED_ENTRY)}))]);case 2:return e.abrupt("return",e.sent.filter((function(e){return e})));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),t.createAssetActions=function(){var e=O(Re.mark((function e(n){return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.maybeBuildEmbedAction(u.BLOCKS.EMBEDDED_ASSET,null,(function(){t.setState({breadcrumb:"Asset",isLoading:!0}),t.createCommands(null,u.BLOCKS.EMBEDDED_ASSET),t.clearCommand()})),n.maybeBuildCreateAndEmbedAction(u.BLOCKS.EMBEDDED_ASSET,null,(function(){return t.onCreateAndEmbedEntity(null,u.BLOCKS.EMBEDDED_ASSET)}))]);case 2:return e.abrupt("return",e.sent.filter((function(e){return e})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.handleScroll=function(e){"UL"!==e.target.nodeName&&t.updatePanelPosition()},t.clearCommand=function(){"/"!==t.props.command&&Kn(t.props.editor,t.props.command,0)},t.createCommands=function(){var e=O(Re.mark((function e(n,r,i){var o;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.setState({isUpdating:!0}),n){e.next=7;break}return e.next=4,_n(t.props.richTextAPI.sdk,i);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,Hn(t.props.richTextAPI.sdk,n,i);case 9:e.t0=e.sent;case 10:o=e.t0,t.isComponentMounted&&t.setState({currentCommand:{contentType:n,type:r,command:i},isUpdating:!1,isLoading:!1,items:o.map((function(e){return t.createCommand(e.displayTitle,e.contentTypeName,e.entry,r,e.description,e.thumbnail)}))});case 12:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),t.createInitialCommands=O(Re.mark((function e(){var n,r,i,o,s;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t.props.richTextAPI.sdk).space.getCachedContentTypes(),t.setState({isLoading:!1}),i=new Un(n),e.t0=R,e.next=7,Promise.all(r.map((function(e){return t.createContentTypeActions(i,e)})));case 7:return e.t1=e.sent,o=(0,e.t0)(e.t1),e.next=11,t.createAssetActions(i);case 11:s=e.sent,t.setState((function(e){return{items:[].concat(e.items,o,s)}}));case 13:case"end":return e.stop()}}),e)}))),t.handleKeyboard=function(e){var n=y("esc",e);(n||y("down",e)||y("up",e)||y("enter",e))&&(e.preventDefault(),e.stopPropagation()),(n||y("tab",e))&&t.setState({isClosed:!0})},t}_(t,e);var r=t.prototype;return r.componentDidMount=function(){var e=O(Re.mark((function e(){return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isComponentMounted=!0,e.next=3,this.createInitialCommands();case 3:this.updatePanelPosition(),this.paletteDimensions={height:this.palette.getBoundingClientRect().height,width:this.palette.getBoundingClientRect().width};case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.componentWillUnmount=function(){this.isComponentMounted=!1,this.removeEventListeners(),this.requestUpdate.cancel()},r.componentDidUpdate=function(){this.state.currentCommand&&this.state.currentCommand.command!==this.props.command?this.requestUpdate():this.requestUpdate.cancel(),this.state.isClosed?this.removeEventListeners():this.bindEventListeners()},r.render=function(){var e=this;if(this.state.isClosed)return null;var t=window.document.body;return D.createPortal(n.createElement("div",{tabIndex:"1",ref:function(t){e.palette=t},style:{position:"absolute",outline:"none",minWidth:200,top:this.state.anchorPosition.top,left:this.state.anchorPosition.left}},n.createElement(m.InViewport,{onOverflowBottom:function(){"top"!==e.state.panelPosition&&e.setState({panelPosition:"top"},e.updatePanelPosition)},onOverflowTop:function(){"bottom"!==e.state.panelPosition&&e.setState({panelPosition:"bottom"},e.updatePanelPosition)}},n.createElement(Vn,{searchString:"/"===this.props.command?"":this.props.command,items:this.state.items,isLoading:this.state.isLoading,isUpdating:this.state.isUpdating,onClose:function(){e.setState({isClosed:!0})},breadcrumb:this.state.breadcrumb,richTextAPI:this.props.richTextAPI}))),t)},r.updatePanelPosition=function(){var e=this,t=document.getSelection().getRangeAt(0).getBoundingClientRect();this.setState((function(n){return{anchorPosition:{top:"bottom"===n.panelPosition?t.bottom:t.top-e.paletteDimensions.height,left:t.left}}}))},t}(n.PureComponent);Xn.propTypes={editor:r.object,command:r.string,richTextAPI:r.object};var Jn=function(e){function t(t){var n,r;return(n=e.call(this,t)||this).state={embedsEnabled:(r=n.props.richTextAPI.sdk.field,Ue(r,u.BLOCKS.EMBEDDED_ASSET)||Ue(r,u.BLOCKS.EMBEDDED_ENTRY)||Ue(r,u.INLINES.EMBEDDED_ENTRY))},n}return _(t,e),t.prototype.render=function(){return function(e){var t=e.value.document.getDecorations(e);if(t.isEmpty())return!1;var n=t.find((function(e){return"richTextCommandsContext"===e.mark.type}));return Boolean(n)}(this.props.editor)&&this.state.embedsEnabled?n.createElement(Xn,{editor:this.props.editor,richTextAPI:this.props.richTextAPI,command:On(this.props.editor)}):null},t}(n.PureComponent);Jn.propTypes={editor:r.object,richTextAPI:r.object};var $n=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t.prototype.render=function(){var e=this.props,t=e.children;return n.createElement("span",K({tabIndex:"1"},e.attributes,{className:"command-context"}),t)},t}(n.PureComponent);$n.propTypes={children:r.node.isRequired,editor:r.object,attributes:r.object};var Zn=function(e){var t=e.richTextAPI;return{decorateNode:function(e,t,n){var r=n(),i=function(e){var t=e.value;if(!t.startText)return null;var n=On(e),r=t.selection;return n?{anchor:{key:r.start.key,offset:r.start.offset-(n.length+1)},focus:{key:r.start.key,offset:r.start.offset},mark:{type:"richTextCommandsContext"}}:null}(t);return i?[].concat(r,[i]):[].concat(r)},renderMark:function(e,t,r){return"richTextCommandsContext"===e.mark.type?n.createElement($n,{attributes:e.attributes,editor:t},e.children):r()},renderEditor:function(e,r,i){var o=i();return n.createElement(n.Fragment,null,o,n.createElement(Jn,{anchor:r.state.commandMark,value:r.value,editor:r,richTextAPI:t}))}}};function er(e){return[{schema:W},{onKeyDown:function(e,t,n){if(!y("enter",e)||!function(e){return e.value.document.getBlocks().first()===e.value.focusBlock&&e.isVoid(e.value.focusBlock)}(t))return n();!function(e){e.splitBlock().moveToStartOfDocument().setBlocks(u.BLOCKS.PARAGRAPH).focus()}(t)}},(a={richTextAPI:e},oe({type:u.MARKS.BOLD,tagName:"b",hotkey:["mod+b"],richTextAPI:a.richTextAPI})),ue({richTextAPI:e}),Ct({richTextAPI:e}),It({richTextAPI:e}),fe({richTextAPI:e}),ye({richTextAPI:e}),xe({richTextAPI:e}),St({richTextAPI:e}),Ut({richTextAPI:e}),Ft({richTextAPI:e}),Yt({richTextAPI:e}),Gt({richTextAPI:e}),zt({richTextAPI:e}),Wt({richTextAPI:e}),(void 0===r&&(r=u.BLOCKS.PARAGRAPH),function(e,t,n,r){return{renderNode:function(t,r,i){return t.node.type===e?Ie("div",n)(t):i()},onKeyDown:function(t,n,i){if(!y(r,t))return i();n.call(ve,e)}}}(r,0,{},["mod+opt+0"])),{renderNode:function(e,t,r){return e.node.type===u.BLOCKS.HR?n.createElement("hr",K({className:E.cx(Ln.hr,e.isSelected&&Ln.hrSelected)},e.attributes)):r()}},vn({richTextAPI:e}),(s={richTextAPI:e},an({richTextAPI:s.richTextAPI,nodeType:u.BLOCKS.EMBEDDED_ENTRY,hotkey:["mod+shift+e"]})),(o={richTextAPI:e},an({richTextAPI:o.richTextAPI,nodeType:u.BLOCKS.EMBEDDED_ASSET,hotkey:["mod+shift+a"]})),K({},Y(),{renderNode:function(e,t,n){return e.node.type===u.BLOCKS.UL_LIST?Ie("ul")(e):e.node.type===u.BLOCKS.OL_LIST?Ie("ol")(e):e.node.type===u.BLOCKS.LIST_ITEM?Ie("li")(e):n()}}),Rn({richTextAPI:e}),(t=new L({rules:Pn}),{onPaste:function(e,n,r){var o=i.getEventTransfer(e);if("html"==o.type){var s=t.deserialize(o.html);n.insertFragment(s.document)}else r()}}),{onPaste:function(e,t,n){var r=i.getEventTransfer(e);if("text"===r.type){var o=x.deserialize(r.text,{defaultBlock:u.BLOCKS.PARAGRAPH,delimiter:"\n\n"});t.insertFragment(o.document)}else n()}},Zn({richTextAPI:e}),A({type:u.BLOCKS.PARAGRAPH}),{onKeyDown:function(e,t,n){if(!y("shift+enter",e))return n();t.insertText("\n")}}];var t,r,o,s,a}var tr=function(e){function t(){return e.apply(this,arguments)||this}return _(t,e),t.prototype.render=function(){var e=this.props,t=e.isOpen,r=e.onClose,i=e.children;return n.createElement(m.Dropdown,{className:"toolbar-entry-dropdown",position:"bottom-right",toggleElement:n.createElement(m.Button,{onClick:e.onToggle,"data-test-id":"toolbar-entry-dropdown-toggle",className:"toolbar-entry-dropdown-toggle",indicateDropdown:!0,buttonType:"muted",size:"small",icon:"Plus",disabled:this.props.disabled},"Embed"),isOpen:t,onClose:r},n.createElement(m.DropdownList,{className:"toolbar-entry-dropdown-list"},i))},t}(t.Component);tr.propTypes={children:r.node.isRequired,isOpen:r.bool,disabled:r.bool,onClose:r.func,onToggle:r.func};var nr={embedActionsWrapper:E.css({display:["-webkit-box","-ms-flexbox","flex"],webkitAlignSelf:"flex-start",alignSelf:"flex-start",msFlexItemAlign:"start",marginLeft:"auto"}),formattingOptionsWrapper:E.css({display:["-webkit-box","-ms-flexbox","flex"],msFlexAlign:"center",webkitBoxAlign:"center",alignItems:"center",msFlexWrap:"wrap",flexWrap:"wrap",marginRight:"20px"})},rr=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).hasMounted=!1,t.isReadyToSetFocusProgrammatically=!1,t.state=K({headingMenuOpen:!1,canAccessAssets:!1},ir(t.props.richTextAPI.sdk.field)),t.onChange=function(){var e;t.setState({headingMenuOpen:!1}),(e=t.props).onChange.apply(e,arguments)},t.toggleEmbedDropdown=function(){return t.setState((function(e){return{isEmbedDropdownOpen:!e.isEmbedDropdownOpen}}))},t.handleEmbedDropdownClose=function(){return t.setState({isEmbedDropdownOpen:!1})},t.renderEmbeds=function(e){var r=t.props.richTextAPI.sdk.field,i=Ue(r,u.INLINES.EMBEDDED_ENTRY),o=Ue(r,u.BLOCKS.EMBEDDED_ENTRY),s=t.state.canAccessAssets&&Ue(r,u.BLOCKS.EMBEDDED_ASSET),a=[i,o,s].filter(Boolean).length;return n.createElement("div",{className:nr.embedActionsWrapper},a>1?n.createElement(tr,{onToggle:t.toggleEmbedDropdown,isOpen:t.state.isEmbedDropdownOpen,disabled:e.disabled,onClose:t.handleEmbedDropdownClose},o&&n.createElement(rn,K({nodeType:u.BLOCKS.EMBEDDED_ENTRY},e)),i&&n.createElement(pn,e),s&&n.createElement(rn,K({nodeType:u.BLOCKS.EMBEDDED_ASSET},e))):n.createElement(n.Fragment,null,o&&n.createElement(rn,K({nodeType:u.BLOCKS.EMBEDDED_ENTRY,isButton:!0},e)),i&&n.createElement(pn,K({isButton:!0},e)),s&&n.createElement(rn,K({nodeType:u.BLOCKS.EMBEDDED_ASSET,isButton:!0},e))))},t.toggleHeadingMenu=function(e){e.preventDefault(),t.setState((function(e){return{headingMenuOpen:!e.headingMenuOpen}}))},t.closeHeadingMenu=function(){return t.setState({headingMenuOpen:!1})},t}_(t,e);var r=t.prototype;return r.componentDidMount=function(){var e=this;this.hasMounted=!0,this.props.richTextAPI.sdk.access.can("read","Asset").then((function(t){e.hasMounted&&e.setState({canAccessAssets:t})}))},r.componentWillUnmount=function(){this.hasMounted=!1},r.render=function(){var e=this.props,t=e.editor,r=e.isDisabled,i=e.richTextAPI;t.value.selection.isFocused&&(this.isReadyToSetFocusProgrammatically=!0);var o={editor:t,onToggle:this.onChange,onCloseEmbedMenu:this.toggleEmbedDropdown,disabled:r,richTextAPI:i,canAutoFocus:this.isReadyToSetFocusProgrammatically},s=i.sdk.field,a=this.state,c=a.isAnyHyperlinkEnabled,l=a.isAnyListEnabled,d=a.isAnyMarkEnabled,p=o.editor.value.blocks.getIn([0,"type"]);return n.createElement(m.EditorToolbar,{"data-test-id":"toolbar"},n.createElement("div",{className:nr.formattingOptionsWrapper},n.createElement(_t,{onToggle:this.toggleHeadingMenu,isToggleActive:!0,isOpen:this.state.headingMenuOpen,onClose:this.closeHeadingMenu,currentBlockType:p,disabled:o.disabled},n.createElement(qt,o),Ue(s,u.BLOCKS.HEADING_1)&&n.createElement(Vt,o),Ue(s,u.BLOCKS.HEADING_2)&&n.createElement(Qt,o),Ue(s,u.BLOCKS.HEADING_3)&&n.createElement(Xt,o),Ue(s,u.BLOCKS.HEADING_4)&&n.createElement(Jt,o),Ue(s,u.BLOCKS.HEADING_5)&&n.createElement($t,o),Ue(s,u.BLOCKS.HEADING_6)&&n.createElement(Zt,o)),d&&n.createElement(m.EditorToolbarDivider,{testId:"mark-divider"}),Fe(s,u.MARKS.BOLD)&&n.createElement(le,o),Fe(s,u.MARKS.ITALIC)&&n.createElement(pe,o),Fe(s,u.MARKS.UNDERLINE)&&n.createElement(me,o),Fe(s,u.MARKS.CODE)&&n.createElement(ge,o),Fe(s,u.MARKS.SUPERSCRIPT)&&n.createElement(xt,o),Fe(s,u.MARKS.SUBSCRIPT)&&n.createElement(At,o),c&&n.createElement(n.Fragment,null,n.createElement(m.EditorToolbarDivider,{testId:"hyperlink-divider"}),n.createElement(lt,o)),l&&n.createElement(m.EditorToolbarDivider,{testId:"list-divider"}),Ue(s,u.BLOCKS.UL_LIST)&&n.createElement(Cn,o),Ue(s,u.BLOCKS.OL_LIST)&&n.createElement(kn,o),Ue(s,u.BLOCKS.QUOTE)&&n.createElement(Ne,o),Ue(s,u.BLOCKS.HR)&&n.createElement(Dn,o)),this.renderEmbeds(o))},t}(n.Component);function ir(e){return{isAnyMarkEnabled:Fe(e,u.MARKS.BOLD)||Fe(e,u.MARKS.ITALIC)||Fe(e,u.MARKS.UNDERLINE)||Fe(e,u.MARKS.CODE)||Fe(e,u.MARKS.SUPERSCRIPT)||Fe(e,u.MARKS.SUBSCRIPT),isAnyHyperlinkEnabled:Ue(e,u.INLINES.HYPERLINK)||Ue(e,u.INLINES.ASSET_HYPERLINK)||Ue(e,u.INLINES.ENTRY_HYPERLINK),isAnyListEnabled:Ue(e,u.BLOCKS.UL_LIST)||Ue(e,u.BLOCKS.OL_LIST)||Ue(e,u.BLOCKS.QUOTE)||Ue(e,u.BLOCKS.HR)}}function or(){var e=q(["\n    position: -webkit-sticky;\n    position: sticky;\n    top: -1px;\n    z-index: 2;\n  "]);return or=function(){return e},e}rr.propTypes={richTextAPI:r.object.isRequired,isDisabled:r.bool.isRequired,editor:r.object.isRequired,onChange:r.func.isRequired};var sr={nativeSticky:E.css(or())},ar=function(e){return n.createElement("div",{className:e.isDisabled?"":sr.nativeSticky},e.children)};ar.propTypes={isDisabled:r.bool,children:r.node};var cr="1px solid "+g.colorElementDark,lr={root:E.css({position:"relative"}),editor:E.css({borderRadius:"0 0 3px 3px",border:cr,borderTop:0,padding:"20px",fontSize:g.spacingM,minHeight:"400px",background:g.colorWhite,outline:"none",whiteSpace:"pre-wrap",overflowWrap:"break-word",webkitUserModify:"read-write-plaintext-only",a:{span:{cursor:"not-allowed","&:hover":{cursor:"not-allowed"}}}}),hiddenToolbar:E.css({borderTop:cr}),enabled:E.css({background:g.colorWhite,a:{span:{cursor:"pointer","&:hover":{cursor:"pointer"}}}}),disabled:E.css({background:g.colorElementLightest})},ur=function(e){var t=d.toSlatejsDocument({document:e,schema:W}),n=o.Value.fromJSON({document:t,schema:W});return new o.Editor({readOnly:!0,value:n},{normalize:!0}).value},dr=ur(u.EMPTY_DOCUMENT),pr=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).state={lastOperations:c.List(),value:t.props.value&&t.props.value.nodeType===u.BLOCKS.DOCUMENT?ur(t.props.value):dr},t.editor=n.createRef(),t.richTextAPI=Q({sdk:t.props.sdk,onAction:t.props.onAction}),t.slatePlugins=er(t.richTextAPI),t.onChange=function(e){t.setState({value:e.value,lastOperations:e.operations.filter(fr)})},t.callOnChange=a((function(){var e=d.toContentfulDocument({document:t.state.value.document.toJSON(),schema:W});t.props.onChange(e)}),500),t.handleKeyDown=function(e,t,n){return 27===e.keyCode&&e.currentTarget.blur(),n()},t}_(t,e);var r=t.prototype;return r.shouldComponentUpdate=function(e,t){return this.props.isDisabled!==e.isDisabled||!c.is(this.state.value,t.value)||this.props.value!==e.value},r.componentDidUpdate=function(e){var t=this,n=!this.state.lastOperations.isEmpty();!this.props.isDisabled&&n?this.setState({lastOperations:c.List()},(function(){return t.callOnChange()})):l(e.value,t.props.value)||this.setState({value:ur(this.props.value)})},r.render=function(){var e=E.cx(lr.editor,this.props.isDisabled?lr.disabled:lr.enabled,this.props.isToolbarHidden&&lr.hiddenToolbar);return n.createElement("div",{className:lr.root,"data-test-id":"rich-text-editor"},!this.props.isToolbarHidden&&n.createElement(ar,{isDisabled:this.props.isDisabled},n.createElement(rr,{editor:this.editor.current||new o.Editor({readOnly:!0}),onChange:this.onChange,isDisabled:this.props.isDisabled,richTextAPI:this.richTextAPI})),n.createElement(i.Editor,{"data-test-id":"editor",value:this.state.value,ref:this.editor,onChange:this.onChange,onKeyDown:this.handleKeyDown,plugins:this.slatePlugins,readOnly:this.props.isDisabled,className:e,actionsDisabled:this.props.actionsDisabled,options:{normalize:!1}}))},t}(n.Component);function fr(e){if("set_value"===e.type){if(e.properties.data)return!1}else if("set_selection"===e.type)return!1;return!0}function hr(e){var t=e.sdk,r=e.isInitiallyDisabled,i=M(e,["sdk","isInitiallyDisabled"]);return n.createElement(p.EntityProvider,{sdk:t},n.createElement(k.FieldConnector,{throttle:0,field:t.field,isInitiallyDisabled:r,isEmptyValue:function(e){return!e||l(e,u.EMPTY_DOCUMENT)},isEqualValues:function(e,t){return l(e,t)}},(function(e){var r=e.setValue;return n.createElement(pr,K({},i,{key:"rich-text-editor-"+e.externalReset,value:e.lastRemoteValue,sdk:t,isDisabled:e.disabled,onChange:function(e){r(e)}}))})))}pr.propTypes={sdk:r.shape({field:r.shape({id:r.string.isRequired,locale:r.string.isRequired}).isRequired,access:r.shape({can:r.func.isRequired}).isRequired,parameters:r.shape({instance:r.shape({getEntryUrl:r.func,getAssetUrl:r.func}).isRequired})}).isRequired,value:r.object,isDisabled:r.bool,onChange:r.func,onAction:r.func,isToolbarHidden:r.bool,actionsDisabled:r.bool},pr.defaultProps={value:u.EMPTY_DOCUMENT,onChange:s,onAction:s,isDisabled:!1,isToolbarHidden:!1,actionsDisabled:!1},hr.defaultProps={isInitiallyDisabled:!0},exports.ConnectedRichTextEditor=pr,exports.RichTextEditor=hr,exports.openRichTextDialog=function(e){return function(t){return t.parameters&&"rich-text-hyperlink-dialog"===t.parameters.type?k.ModalDialogLauncher.openDialog(t,(function(r){return n.createElement(Oe,K({},t.parameters,{onClose:r.onClose,sdk:e}))})):Promise.reject()}},exports.renderRichTextDialog=function(e){return"rich-text-hyperlink-dialog"===e.parameters.invocation.type?(e.window.startAutoResizer(),n.createElement(Oe,K({},e.parameters.invocation,{onClose:e.close,sdk:e}))):n.createElement("div",null)};
//# sourceMappingURL=field-editor-rich-text.cjs.production.min.js.map
